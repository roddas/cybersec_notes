# SMB
## Enumeration
 1. [SMB Access from Linux Cheat Sheet by SANS](https://www.willhackforsushi.com/sec504/SMB-Access-from-Linux.pdf)
 2. [PsExec](https://learn.microsoft.com/en-us/sysinternals/downloads/psexec)
 3. [rpcclient](https://www.samba.org/samba/docs/current/man-html/rpcclient.1.html)
 4. [enum4linux-ng](https://github.com/cddmp/enum4linux-ng)
 5. [CrackMapExec - CME](https://github.com/byt3bl33d3r/CrackMapExec)
    1. [Old documentation](https://web.archive.org/web/20220129050920/https://mpgn.gitbook.io/crackmapexec/getting-started/using-credentials)


```
sudo nmap -sV -sC -p139,445 $rhost
```

## File Share
Using smbclient, we can display a list of the server's shares with the option -L, and using the option -N, we tell smbclient to use the null session.
```
smbclient -N -L //$rhost
```
Smbmap is another tool that helps us enumerate network shares and access associated permissions. An advantage of smbmap is that it provides a list of permissions for each shared folder.
```
smbmap -H $rhost
```
Using smbmap with the -r or -R (recursive) option, one can browse the directories:
```
smbmap -H $rhost -r $folder
smbmap -H $rhost --download "full path\...\filename.extension" # To download a file
smbmap -H $rhost --upload filename.extension "full path\...\filename.extension" # To upload a file
```

## Remote Procedure Call (RPC)

```
rpcclient -U'%' $rhost
```
Enum4linux is another utility that supports null sessions, and it utilizes nmblookup, net, rpcclient, and smbclient to automate some common enumeration from SMB targets such as:
 1. Workgroup/Domain name
 2. Users information
 3. Operating system information
 4. Groups information
 5. Shares Folders
 6. Password policy information
```
./enum4linux-ng.py $rhost -A -C
```
### Brute Forcing and Password Spray
```
crackmapexec smb $rhost -u $wordlist -p 'some_password' --local-auth
```
### Remote Code Execution (RCE)
